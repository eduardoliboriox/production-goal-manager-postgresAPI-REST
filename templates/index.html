<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema de Metas - Venttos Electronics</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* ===== Cabe칞alho responsivo ===== */
        .logo {
            height: 55px;
            width: auto;
            max-width: 100%;
        }

        .divider {
            border: none;
            height: 1px;
            background-color: #000;
            margin-bottom: 25px;
        }

        /* ===== BOT칏ES PADRONIZADOS ===== */
        .btn-custom {
            width: 180px;              /* largura fixa no PC */
            max-width: 100%;           /* garante que n칚o estoure em telas pequenas */
            display: inline-block;
        }

        /* Centralizar bot칫es isolados */
        .text-center .btn-custom {
            margin: 5px auto;
        }

        /* No celular: bot칚o ocupa toda a largura */
        @media (max-width: 576px) {
            .btn-custom {
                width: 100%;
            }
        }

        /* Ajustes para telas pequenas (celulares) */
        @media (max-width: 576px) {
            .header-container {
                flex-direction: row;
                justify-content: center;
                text-align: center;
            }
            .header-container img {
                height: 40px;
                margin-right: 8px;
            }
            .header-container h2 {
                font-size: 1.2rem;
                white-space: nowrap;
            }
        }
                /* Bot칚o "Listar Modelos" um pouco mais largo */
        .btn-listar {
            width: 340px; /* largura maior s칩 para esse bot칚o */
            max-width: 100%;
        }

        body { background-color: #f8f9fa; }
        h2 { font-size: 1.6rem; }
        h4 { font-size: 1.2rem; margin-top: 25px; }
        .form-section { margin-bottom: 30px; }
        .fade-in { animation: fadeIn .4s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: scaleY(0.9); }
            to { opacity: 1; transform: scaleY(1); }
        }
        @media (max-width: 576px) {
            h2 { font-size: 1.4rem; }
            h4 { font-size: 1.1rem; }
            button, select, input { font-size: 0.9rem !important; }
        }
    </style>
</head>
<body>
<div class="container py-4">
    <!-- Cabe칞alho com logo e t칤tulo -->
    <div class="header-container d-flex align-items-center flex-wrap mb-3">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Venttos Electronics" class="logo me-2">
        <h2 class="m-0 flex-grow-1 text-nowrap">Sistema de Metas</h2>
    </div>

    <!-- Linha divis칩ria -->
    <hr class="divider">

    {% if mensagem %}
    <div class="alert alert-info text-center">{{ mensagem|safe }}</div>
    {% endif %}

    <!-- 游늶 Cadastro -->
    <div class="form-section">
        <h4>游늶 Cadastro de Modelo</h4>
        <form action="/cadastrar" method="post" class="row gy-2 gx-2 text-center">
            <div class="col-12 col-md-3"><input class="form-control" name="codigo" placeholder="C칩digo" required></div>
            <div class="col-12 col-md-3"><input class="form-control" name="cliente" placeholder="Cliente" required></div>
            <div class="col-6 col-md-2">
                <select class="form-select" name="setor">
                    <option>IM</option><option>PA</option><option>VTT</option>
                </select>
            </div>
            <div class="col-6 col-md-2"><input class="form-control" name="meta" placeholder="Meta/Hora" required type="number"></div>
            <div class="col-6 col-md-2"><input class="form-control" name="pessoas" placeholder="Pessoas Padr칚o" required type="number"></div>
            <div class="col-12 text-center">
                <button class="btn btn-primary btn-custom mt-2">Cadastrar</button>
            </div>
        </form>
    </div>

    <!-- 游댍 Consultar / Editar / Excluir -->
    <div class="form-section">
        <h4>游댍 Consultar / Editar / Excluir</h4>

        <!-- Editar -->
        <form action="/editar" method="post" class="row gy-2 gx-2 text-center">
            <div class="col-12 col-md-3">
                <select class="form-select" name="codigo" required>
                    {% for c in codigos %}
                    <option>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-6 col-md-3"><input class="form-control" name="nova_meta" placeholder="Nova Meta/Hora"></div>
            <div class="col-6 col-md-3"><input class="form-control" name="novas_pessoas" placeholder="Novas Pessoas"></div>
            <div class="col-12 col-md-3 text-center">
                <button class="btn btn-warning btn-custom">Editar</button>
            </div>
        </form>

        <!-- Excluir -->
        <form action="/excluir" method="post" class="row gy-2 gx-2 mt-2 text-center">
            <div class="col-12 col-md-3">
                <select class="form-select" name="codigo" required>
                    {% for c in codigos %}
                    <option>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-12 col-md-3 text-center">
                <button class="btn btn-danger btn-custom">Excluir</button>
            </div>
        </form>

        <!-- Listar -->
        <div class="mt-3 text-center">
            <button id="btnListar" class="btn btn-secondary btn-custom btn-listar">
                游늯 Listar Modelos Cadastrados
            </button>
        </div>


        <!-- Tabela de listagem -->
        <div id="tabelaContainer" class="mt-3" style="display:none;">
            <div class="card shadow-sm fade-in">
                <div class="card-body p-2">
                    <table class="table table-sm table-bordered table-striped bg-white mb-0">
                        <thead class="table-light text-center">
                            <tr>
                                <th>C칩digo</th>
                                <th>Cliente</th>
                                <th>Setor</th>
                                <th>Meta/Hora</th>
                                <th>Pessoas</th>
                            </tr>
                        </thead>
                        <tbody id="listaModelos"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 游빑 Calcular Meta Ajustada -->
    <div class="form-section">
        <h4>游빑 Calcular Meta Ajustada</h4>
        <form id="calcForm" class="row gy-2 gx-2 text-center">
            <div class="col-12 col-md-3">
                <select class="form-select" name="codigo" required>
                    {% for c in codigos %}
                    <option>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-6 col-md-3"><input class="form-control" name="pessoas_atuais" placeholder="Pessoas Atuais" required type="number"></div>
            <div class="col-6 col-md-3"><input class="form-control" name="minutos" value="60" required type="number"></div>
            <div class="col-12 col-md-3 text-center">
                <button type="submit" class="btn btn-success btn-custom">Calcular</button>
            </div>
        </form>

        <div id="resultadoCalc" class="mt-3 text-center fw-bold p-2 border rounded bg-white shadow-sm"></div>
    </div>

    <p class="text-end text-muted" style="font-size:10px;">Desenvolvido por Eduardo Lib칩rio</p>
</div>

<script>
// ====== Calcular Meta (AJAX) ======
document.getElementById("calcForm").addEventListener("submit", async function(event) {
    event.preventDefault();
    const formData = new FormData(this);
    const response = await fetch("/calcular", { method: "POST", body: formData });
    const data = await response.json();
    const box = document.getElementById("resultadoCalc");
    box.innerHTML = data.resultado;
    box.style.backgroundColor = "#e7f9ef";
    setTimeout(() => box.style.backgroundColor = "#fff", 1000);
});

// ====== Listar / Recolher Lista ======
document.getElementById("btnListar").addEventListener("click", async function() {
    const tabelaContainer = document.getElementById("tabelaContainer");
    const corpo = document.getElementById("listaModelos");
    const botao = this;

    if (tabelaContainer.style.display === "block") {
        tabelaContainer.style.display = "none";
        botao.textContent = "游늯 Listar Modelos Cadastrados";
        return;
    }

    tabelaContainer.style.display = "block";
    botao.textContent = "游댷 Recolher Lista";
    corpo.innerHTML = "<tr><td colspan='5' class='text-center text-muted'>Carregando...</td></tr>";

    const response = await fetch("/listar");
    const data = await response.json();

    if (data.length === 0) {
        corpo.innerHTML = "<tr><td colspan='5' class='text-center text-muted'>Nenhum modelo cadastrado.</td></tr>";
        return;
    }

    corpo.innerHTML = "";
    data.forEach(d => {
        corpo.innerHTML += `
            <tr>
                <td>${d.codigo}</td>
                <td>${d.cliente}</td>
                <td>${d.setor}</td>
                <td>${d.meta_padrao}</td>
                <td>${d.pessoas_padrao}</td>
            </tr>`;
    });
});
</script>

<script>
// ====== Esconder alerta depois de alguns segundos ======
document.addEventListener("DOMContentLoaded", () => {
    const alerta = document.querySelector(".alert");
    if (alerta) {
        setTimeout(() => {
            alerta.style.transition = "opacity 0.6s ease";
            alerta.style.opacity = "0";
            setTimeout(() => alerta.remove(), 600);
        }, 3500);
    }
});
</script>

</body>
</html>
